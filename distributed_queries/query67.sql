SELECT * FROM (SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, sumsales, RANK() OVER (PARTITION BY i_category ORDER BY sumsales DESC) AS rk FROM (SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, SUM(COALESCE(ss_sales_price * ss_quantity, 0)) AS sumsales FROM postgres.public.store_sales, postgres.public.date_dim, postgres.public.store, mysql.db1.item WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND ss_store_sk = s_store_sk AND d_month_seq BETWEEN 1212 AND 1212 + 11 GROUP BY ROLLUP (i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id)) AS dw1) AS dw2 WHERE rk <= 100 ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_brand NULLS FIRST, i_product_name NULLS FIRST, d_year NULLS FIRST, d_qoy NULLS FIRST, d_moy NULLS FIRST, s_store_id NULLS FIRST, sumsales NULLS FIRST, rk NULLS FIRST LIMIT 100